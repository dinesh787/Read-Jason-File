package com.viacom18.Content.web.show_daily_web


import org.apache.spark.sql.{SQLContext, SparkSession}

object show_daily_web {

  val spark = SparkSession.builder()
    .appName("showdailyweb")
    .enableHiveSupport()
    //    .config("fs.wasbs.impl", "org.apache.hadoop.fs.azure.NativeAzureFileSystem")
    //    .config("fs.AbstractFileSystem.wasb.impl", "org.apache.hadoop.fs.azure.Wasb")
    //    .config("fs.azure.account.key.v18biblobstorprod.blob.core.windows.net", "K1ZcztvuFkq6Hy4P8Uf13kP3yXgXxQJBs/bKZ6Y4cfgzD/9nmjHg9uMwIbAe3ZC7vmCS59Mk/3iloAVOs3zdYQ==")
    .getOrCreate()

  val sqlcontext: SQLContext = spark.sqlContext

  def main(args: Array[String]) {

    val date_zero = args(0)
    val Load_type = args(1)
    println("show_daily_web start date ", date_zero)
    show_daily(date_zero,Load_type)

  }

  def show_daily(date_zero: String , Load_type : String) = {
    val st_time = sqlcontext.sql(s""" select CURRENT_TIMESTAMP """).take(1)(0).get(0).toString

    val  VOOTWEBBASE_1 =sqlcontext.sql(s"select * from voot_web_base_ext where date_stamp = '$date_zero'")
    VOOTWEBBASE_1.createOrReplaceTempView("VOOTWEBBASE_1")

    val CONTENT_MAPPER_1 =sqlcontext.sql("select * from CONTENT_MAPPER")
    CONTENT_MAPPER_1.createOrReplaceTempView("CONTENT_MAPPER_1")

    val SBU_CHANNEL_MAPPER_1 =sqlcontext.sql("select * from SBU_CHANNEL_MAPPER")
    SBU_CHANNEL_MAPPER_1.createOrReplaceTempView("SBU_CHANNEL_MAPPER_1")

    val cmSBU_1 = sqlcontext.sql("SELECT V.SBU_CLUSTER ,CAST(ID AS BIGINT),REF_SERIES_TITLE,C.SBU,CONTENT_DURATION,GENRE,LANGUAGE,CONTENT_DURATION_SEC,channel_name_vendor_name,own_bought ,content_type,kids,genre,ref_series_title,start_date FROM CONTENT_MAPPER C LEFT JOIN SBU_CHANNEL_MAPPER V ON V.SBU= C.SBU")
    cmSBU_1.createOrReplaceTempView("cmSBU_1")

    val FINALW_1 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,'All Clusters' AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,'All Genres' AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'First Play' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM  VOOTWebBASE_1 M   LEFT JOIN cmSBU_1 C on C.id = M.mediaid GROUP BY DATE_STAMP")

    FINALW_1.createOrReplaceTempView("FINALW_1")

    val FINALW_2 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,'All Genres' AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY upper(SBU_CLUSTER),DATE_STAMP")

    FINALW_2.createOrReplaceTempView("FINALW_2")

    val FINALW_3 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,'All Clusters' AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(GENRE)")

    FINALW_3.createOrReplaceTempView("FINALW_3")

    val FINALW_4 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(SBU_CLUSTER),upper(GENRE)")

    FINALW_4.createOrReplaceTempView("FINALW_4")

    val FINALW_5 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,upper(SBU) AS SBU,upper(channel_name_vendor_name) AS CHANNEL_VENDOR_NAME,upper(own_bought) AS OWN_BOUGHT_FLAG,upper(kids) AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,ref_series_title AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,ref_series_title,upper(SBU_CLUSTER),upper(SBU),upper(channel_name_vendor_name),upper(own_bought),upper(kids),upper(GENRE)")

    FINALW_5.createOrReplaceTempView("FINALW_5")

    val FINALW_6 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,upper(SBU) AS SBU,upper(channel_name_vendor_name) AS CHANNEL_VENDOR_NAME,upper(own_bought) AS OWN_BOUGHT_FLAG,upper(kids) AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,upper(ref_series_title) AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(ref_series_title),upper(LANGUAGE),upper(SBU_CLUSTER),upper(SBU),upper(channel_name_vendor_name),upper(own_bought),upper(kids),upper(GENRE)")

    FINALW_6.createOrReplaceTempView("FINALW_6")

    val FINALW_7 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,'All Clusters' AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,'All Genres' AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,LANGUAGE")

    FINALW_7.createOrReplaceTempView("FINALW_7")


    val FINALW_8 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,'All Genres' AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(SBU_CLUSTER),upper(LANGUAGE)")

    FINALW_8.createOrReplaceTempView("FINALW_8")


    val FINALW_9 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,'All Clusters' AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(GENRE),upper(LANGUAGE)")

    FINALW_9.createOrReplaceTempView("FINALW_9")

    val FINALW_10 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,'ALL' AS Recent_7D,'ALL' AS Recent_14D,'ALL' AS Recent_30D,'ALL' AS Recent_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(SBU_CLUSTER),upper(GENRE),upper(LANGUAGE)")

    FINALW_10.createOrReplaceTempView("FINALW_10")

    val FINALW_11 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,'All Clusters' AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,'All Genres' AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D  FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END ")

    FINALW_11.createOrReplaceTempView("FINALW_11")

    val FINALW_12 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,'All Genres' AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D  FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(SBU_CLUSTER),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END ")

    FINALW_12.createOrReplaceTempView("FINALW_12")

    val FINALW_13 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,'All Clusters' AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D  FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(GENRE),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END ")


    FINALW_13.createOrReplaceTempView("FINALW_13")

    val FINALW_14 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D FROM VOOTWebBASE_1 M LEFT JOIN cmSBU_1 C  on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(SBU_CLUSTER),upper(GENRE),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END ")


    FINALW_14.createOrReplaceTempView("FINALW_14")

    val FINALW_15 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,upper(SBU) AS SBU,upper(channel_name_vendor_name) AS CHANNEL_VENDOR_NAME,upper(own_bought) AS OWN_BOUGHT_FLAG,upper(KIDS) AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,upper(REF_SERIES_TITLE) AS SHOW_NAME,'All Languages' AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(REF_SERIES_TITLE),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END,upper(SBU_CLUSTER),upper(SBU),upper(channel_name_vendor_name),upper(own_bought),upper(KIDS),upper(GENRE)")


    FINALW_15.createOrReplaceTempView("FINALW_15")

    val FINALW_16 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,upper(SBU) AS SBU,upper(channel_name_vendor_name) AS CHANNEL_VENDOR_NAME,upper(own_bought) AS OWN_BOUGHT_FLAG,upper(KIDS) AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,upper(REF_SERIES_TITLE) AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(REF_SERIES_TITLE),upper(LANGUAGE),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END,upper(SBU_CLUSTER),upper(SBU),upper(channel_name_vendor_name),upper(own_bought),upper(KIDS),upper(GENRE) ")


    FINALW_16.createOrReplaceTempView("FINALW_16")

    val FINALW_17 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,'All Clusters' AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,'All Genres' AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(LANGUAGE),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END ")


    FINALW_17.createOrReplaceTempView("FINALW_17")

    val FINALW_18 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,'All Genres' AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(SBU_CLUSTER),upper(LANGUAGE),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END ")


    FINALW_18.createOrReplaceTempView("FINALW_18")

    val FINALW_19 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,'All Clusters' AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(GENRE),upper(LANGUAGE),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END ")


    FINALW_19.createOrReplaceTempView("FINALW_19")

    val FINALW_20 = sqlcontext.sql("SELECT 'Web' AS PROGRAM,CAST(DATE_STAMP AS DATE) AS DATE,upper(SBU_CLUSTER) AS SBU_CLUSTER,'ALL' AS SBU,'ALL' AS CHANNEL_VENDOR_NAME,'ALL' AS OWN_BOUGHT_FLAG,'ALL' AS KIDS_FLAG,upper(GENRE) AS GENRE,0 AS CONTENT_DURATION_SEC,'ALL' AS SHOW_NAME,upper(LANGUAGE) AS CONTENT_LANGUAGE,COUNT(DISTINCT CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN  DISTINCT_ID ELSE NULL END) AS NUM_VIEWERS, SUM(CASE WHEN UPPER(M.EVENT) = 'FIRST PLAY' THEN COUNT_PLAIN ELSE 0 END) AS NUM_VIEWS, 0 as DURATION_WATCHED_SECS,CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_7D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_14D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_30D, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END AS RECENT_90D FROM VOOTWebBASE_1 M  LEFT JOIN cmSBU_1 C on C.id = M.mediaid  GROUP BY DATE_STAMP,upper(SBU_CLUSTER),upper(GENRE),upper(LANGUAGE),CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=7 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=14 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=30 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END, CASE WHEN DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) <=90 AND DATEDIFF(M.DATE_STAMP,date_format(from_unixtime(unix_timestamp(C.START_DATE, 'yyyy-MMM-dd HH:mm:ss')) ,'yyyy-MM-dd')) >=0 THEN  'Y' ELSE 'N' END ")


    FINALW_20.createOrReplaceTempView("FINALW_20")

    val Final11To15=sqlcontext.sql("SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_1 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_2 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_3 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_4 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_5 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_6 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_7 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_8 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_9 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_10 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_11 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_12 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_13 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_14 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_15 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_16 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_17 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_18 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_19 UNION SELECT PROGRAM,DATE,SBU_CLUSTER,SBU,CHANNEL_VENDOR_NAME,OWN_BOUGHT_FLAG,KIDS_FLAG,GENRE,CONTENT_DURATION_SEC,SHOW_NAME,NUM_VIEWERS,NUM_VIEWS,DURATION_WATCHED_SECS,CONTENT_LANGUAGE,Recent_7D,Recent_14D,Recent_30D,Recent_90D FROM FINALW_20")

    Final11To15.createOrReplaceTempView("Final11To15")

    val mediate=sqlcontext.sql("select program ,date ,case when sbu_cluster = 'All' then 'All Clusters' else sbu_cluster end as sbu_cluster,sbu ,channel_vendor_name ,own_bought_flag ,kids_flag ,case when genre = 'All' then 'All Genres' else genre end as genre,content_duration_sec ,show_name ,num_viewers ,num_views ,DURATION_WATCHED_SECS,case when content_language = 'All' then 'All Languages' else content_language end as content_language ,recent_7d ,recent_14d ,recent_30d ,recent_90d ,date as date_part_col from Final11To15")

    mediate.createOrReplaceTempView("mediate")

    sqlcontext.sql("set hive.exec.dynamic.partition.mode=nonstrict")
    sqlcontext.sql("set hive.exec.dynamic.partition=true")

    sqlcontext.sql(s"""insert into F_Agg_Show_Dly partition(date_part_col,project_part_col) select program ,date as date_stamp,sbu_cluster,sbu ,channel_vendor_name ,own_bought_flag ,kids_flag ,genre,content_duration_sec ,show_name ,num_viewers ,num_views ,DURATION_WATCHED_SECS, content_language ,recent_7d ,recent_14d ,recent_30d ,recent_90d ,cast(date as date) as date_part_col ,'WEB' as project_part_col   from  mediate where date_part_col ='$date_zero'""")

    val count = sqlcontext.sql(s""" select count(*) from  F_Agg_Show_Dly where date_part_col ='$date_zero' and project_part_col ='WEB'""").take(1)(0).get(0).toString
    val end_time = sqlcontext.sql(s""" select CURRENT_TIMESTAMP """).take(1)(0).get(0).toString
    val min = sqlcontext.sql(s"""SELECT (unix_timestamp('$end_time') - unix_timestamp('$st_time'))/3600""").take(1)(0).get(0).toString.toDouble.toInt.toString

    sqlcontext.sql(s"""insert into DataTableloadHistory partition(date_stamp) select CURRENT_DATE ,'$date_zero' ,'F_Agg_Show_Dly' ,'$Load_type','WEB', '$count','$st_time','$end_time','$min','yes','content','$date_zero' as date_stamp  from  DataTableloadHistory  limit 1""")



  }
}